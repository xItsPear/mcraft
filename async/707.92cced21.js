"use strict";(self.webpackChunkminecraft_web_client=self.webpackChunkminecraft_web_client||[]).push([["707"],{80881:function(e,t,n){var r,o,a={};n.r(a),n.d(a,{allEntities:()=>eh,entities:()=>ed,floorRandom:()=>eo,frequentUpdates:()=>ec,geometryExport:()=>ew,lightingStarfield:()=>ei,main:()=>en,railsCobweb:()=>er,rotationIssue:()=>el,slabsOptimization:()=>eu,transparencyIssue:()=>es}),n(52003),n(23712),n(12989),n(78873),n(96573),n(94244),n(42050),n(83902),n(79525),n(96220),n(73372);var i=n(4186),s=n(22312),l=n(59240),d=n(13421);n(90804),n(24705),n(53346),n(8705),n(50183),n(52307),n(8416),n(93118),n(82766),n(37151),n(20142),n(89909),n(24578),n(89437),n(802),n(52895),n(46525),n(83930),n(18369),n(41494),n(66616),n(39222),n(83282),n(59237),n(60353),n(40332),n(72040),n(52768),n(2249),n(7960),n(46302),n(64813);var c=n(52676),u=n(30607),p=n(75271),h=n(44846),m=n(9117),f=n(25298),w=n(88376),v=n(95577),y=n(25923),g=n(70754);function playgroundUi_templateObject(){var e=(0,d._)(["\n        position: fixed;\n        inset: 0;\n        height: 100%;\n        display: flex;\n        width: 100%;\n        justify-content: space-between;\n        align-items: flex-end;\n        pointer-events: none;\n        touch-action: none;\n        & > div {\n            pointer-events: auto;\n        }\n    "]);return playgroundUi_templateObject=function(){return e},e}var b=(0,h.sj)({scenes:[],selected:"",selectorOpened:!1,actions:{}});function Playground(){return(0,p.useEffect)(function(){var e=document.createElement("style");return e.innerHTML="\n      .lil-gui {\n        top: 60px !important;\n        right: 0 !important;\n      }\n    ",document.body.appendChild(e),function(){e.remove()}},[]),(0,c.jsxs)("div",{style:{fontFamily:"monospace",color:"white"},children:[(0,c.jsx)(Controls,{}),(0,c.jsx)(SceneSelector,{}),(0,c.jsx)(ActionsSelector,{})]})}function SceneSelector(){var e=(0,g.tq)(),t=(0,m.R)(b),n=t.scenes,r=t.selected,o=(0,l._)((0,p.useState)(!1),2),a=o[0],d=o[1],u=(0,y.Z)(function(){b.selectorOpened=!0},function(){});return a?null:(0,c.jsxs)("div",(0,s._)((0,i._)({style:{position:"fixed",top:0,left:0,display:"flex",alignItems:"flex-start"}},u),{children:[(0,c.jsx)("div",{style:{display:"flex",flexDirection:"column"},children:n.map(function(t){return(0,c.jsx)("div",{style:{padding:e?"5px":"2px 5px",cursor:"pointer",userSelect:"none",background:t===r?"rgba(0, 0, 0, 0.5)":"rgba(0, 0, 0, 0.6)",fontWeight:t===r?"bold":"normal"},onClick:function(){var e=new URLSearchParams(window.location.search);e.set("scene",t),location.search=e.toString()},children:t},t)})}),(0,c.jsx)("div",{style:{padding:e?"5px":"2px 5px",cursor:"pointer",userSelect:"none",background:"rgba(0, 0, 0, 0.6)",fontSize:"14px",lineHeight:"1"},onClick:function(){return d(!0)},children:"\xd7"})]}))}(0,u.my)((0,c.jsx)(Playground,{}),{strictMode:!1,selector:"#react-root"});var ActionsSelector=function(){var e=(0,m.R)(b),t=e.actions;return e.selectorOpened?(0,c.jsx)("div",{style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.5)",zIndex:10,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",gap:5,fontSize:24},children:Object.entries((0,s._)((0,i._)({},t),{Close:function(){b.selectorOpened=!1}})).map(function(e){var t=(0,l._)(e,2),n=t[0],r=t[1];return(0,c.jsx)("div",{style:{padding:"2px 5px",cursor:"pointer",userSelect:"none",background:"rgba(0, 0, 0, 0.5)"},onClick:function(){r(),b.selectorOpened=!1},children:n},n)})}):null},Controls=function(){var e=navigator.maxTouchPoints>0;return((0,p.useEffect)(function(){window.addEventListener("touchstart",function(e){e.preventDefault()});var e=new Set;f.A.setState({isFlying:!1,uiCustomization:{touchButtonSize:40},updateCoord:function(t){var n=(0,l._)(t,2),r=n[0],o=n[1],a=new v.A(0,0,0);a[r]=o,a.z<0&&(c="KeyW"),a.z>0&&(c="KeyS"),a.y>0&&(c="Space"),a.y<0&&(c="ShiftLeft"),a.x<0&&(c="KeyA"),a.x>0&&(c="KeyD"),c&&!e.has(c)&&(e.add(c),window.dispatchEvent(new KeyboardEvent("keydown",{code:c})));var i=!0,s=!1,d=void 0;try{for(var c,u,p=e[Symbol.iterator]();!(i=(u=p.next()).done);i=!0){var h=u.value;h!==c&&(window.dispatchEvent(new KeyboardEvent("keyup",{code:h})),e.delete(h))}}catch(e){s=!0,d=e}finally{try{i||null==p.return||p.return()}finally{if(s)throw d}}}})},[]),e)?(0,c.jsxs)("div",{style:{zIndex:8},className:(0,w.iv)(playgroundUi_templateObject()),children:[(0,c.jsx)(f.HP,{}),(0,c.jsx)("div",{}),(0,c.jsx)(f.Af,{})]}):null},k=n(14772),S=n(41441),_=n(68770),x=n(70980),C=n(93735),B=n(88353),R=n(25763),P=n(81979),F=n(9787);n(66395),n(56843),n(98474),n(27969),n(49245),n(25113),n(56070),n(76148),n(2685),n(72558),n(74822);var U=n(48292),I=n(7230),E=n(34210),W=n.n(E),D=n(2836),A=n(73438);n(58207),n(67022),n(56520),n(83210),n(79653),n(59045),n(40542),n(7611),n(65340),n(2850),n(95790);var O=n(62163),L=n(33885),M=n(10367);n(1239);var V=n(81518),T=n.n(V),z=n(46174),j=n.n(z),G=n(55155),q=n(3646),K=n(32699),H=n.n(K),N=n(55920),Q=n(16145),J=n(92537),Z=n(76491);window.THREE=O;var Y=null!=(r=globalThis.includedVersions)?r:N.ZP,X=function(){function BasePlaygroundScene(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if((0,_._)(this,BasePlaygroundScene),this.continuousRender=!1,this.stopRender=!1,this.windowHidden=!1,this.viewDistance=0,this.targetPos=new v.A(2,90,2),this.version=new URLSearchParams(window.location.search).get("version")||Y.at(-1),this.gui=new q.ZP,this.params={},this.paramOptions={},this.onParamUpdate={},this.alwaysIgnoreQs=[],this.skipUpdateQs=!1,this.enableCameraControls=!0,this.enableCameraOrbitControl=!0,this.frameCount=0,this.lastSecondTime=performance.now(),this.frameTimes=[],this.currentFps=0,this.maxFrameDelay=0,t.version&&(this.version=t.version),!this.version)throw Error("Minecraft version is not set");void 0!==t.viewDistance&&(this.viewDistance=t.viewDistance),t.targetPos&&(this.targetPos=t.targetPos),void 0!==t.enableCameraControls&&(this.enableCameraControls=t.enableCameraControls),void 0!==t.enableCameraOrbitControl&&(this.enableCameraOrbitControl=t.enableCameraOrbitControl),t.worldConfig&&Object.assign(appViewer.inWorldRenderingConfig,t.worldConfig),appViewer.inWorldRenderingConfig.showHand=!1,appViewer.inWorldRenderingConfig.isPlayground=!0,appViewer.inWorldRenderingConfig.instantCameraUpdate=this.enableCameraOrbitControl,appViewer.config.statsVisible=2,void 0!==t.continuousRender&&(this.continuousRender=t.continuousRender),this.initData().then(function(){e.addKeyboardShortcuts()})}var e=BasePlaygroundScene.prototype;return e.onParamsUpdate=function(e,t){},e.updateQs=function(e,t){if(!this.skipUpdateQs){var n=new URLSearchParams(window.location.search),r=!0,o=!1,a=void 0;try{for(var i,s=Object.entries((0,A._)({},e,t))[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var d,c=(0,l._)(i.value,2),u=c[0],p=c[1];"function"==typeof p||(null==(d=this.params.skipQs)?void 0:d.includes(u))||this.alwaysIgnoreQs.includes(u)||(p?n.set(u,p):n.delete(u))}}catch(e){o=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw a}}window.history.replaceState({},"","".concat(window.location.pathname,"?").concat(n.toString()))}},e.renderFinish=function(){this.requestRender()},e.initGui=function(){var e=this,t=new URLSearchParams(window.location.search),n=!0,r=!1,o=void 0;try{for(var a,i=Object.keys(this.params)[Symbol.iterator]();!(n=(a=i.next()).done);n=!0){var s=a.value,l=t.get(s);if(l){var d=/^-?\d+$/.test(l)?Number(l):"true"===l||"false"!==l&&l;this.params[s]=d}}}catch(e){r=!0,o=e}finally{try{n||null==i.return||i.return()}finally{if(r)throw o}}var c=!0,u=!1,p=void 0;try{for(var h,m=Object.keys(this.params)[Symbol.iterator]();!(c=(h=m.next()).done);c=!0){var f,w=h.value,v=this.paramOptions[w];null!=v&&v.hide||this.gui.add(this.params,w,null!=(f=null==v?void 0:v.options)?f:null==v?void 0:v.min,null==v?void 0:v.max)}}catch(e){u=!0,p=e}finally{try{c||null==m.return||m.return()}finally{if(u)throw p}}window.innerHeight<700?this.gui.open(!1):setTimeout(function(){e.gui.domElement.classList.remove("transition")},500),this.gui.onChange(function(t){var n=t.property,r=t.object;if(r===e.params){null==(o=(a=e.onParamUpdate)[n])||o.call(a),e.onParamsUpdate(n,r);var o,a,i,s=e.params[n];(null==(i=e.paramOptions[n])?void 0:i.reloadOnChange)&&("boolean"==typeof s||e.paramOptions[n].options)&&setTimeout(function(){window.location.reload()}),e.updateQs(n,s)}else e.onParamsUpdate(n,r)})},e.setupWorld=function(){},e.sceneReset=function(){},e.addWorldBlock=function(e,t,n,r,o){if(e>16||t>16||n>16)throw Error("Offset too big");var a=o?this.Block.fromProperties(loadedData.blocksByName[r].id,null!=o?o:{},0):this.Block.fromStateId(loadedData.blocksByName[r].defaultState,0);this.world.setBlock(this.targetPos.offset(e,t,n),a)},e.syncCameraToBackend=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(appViewer.backend&&this.camera){var t=new L.P(0,0,-1);t.applyQuaternion(this.camera.quaternion);var n=Math.atan2(-t.x,-t.z),r=Math.asin(t.y);if(e)return void appViewer.backend.updateCamera(null,n,r);var o=new v.A(this.camera.position.x,this.camera.position.y,this.camera.position.z);appViewer.backend.updateCamera(o,n,r)}},e.resetCamera=function(){if(this.camera){var e,t,n=this.targetPos;null==(e=this.controls)||e.target.set(n.x+.5,n.y+.5,n.z+.5);var r=n.offset(2,2,2);this.camera.position.set(r.x+.5,r.y+.5,r.z+.5),this.camera.lookAt(n.x+.5,n.y+.5,n.z+.5),null==(t=this.controls)||t.update(),this.syncCameraToBackend()}},e.initData=function(){var e=this;return(0,k._)(function(){var t,r,o,a,i,s,d,c,u,p,m,f,w,v,y,g;return(0,F.Jh)(this,function(b){switch(b.label){case 0:return[4,window._LOAD_MC_DATA()];case 1:return b.sent(),t=n(63644)(e.version),window.loadedData=window.mcData=t,e.Chunk=j()(e.version),e.Block=T()(e.version),(r=(0,Z.getSyncWorld)(e.version)).setBlockStateId(e.targetPos,0),e.world=r,e.initGui(),appViewer.resourcesManager.currentConfig={version:e.version,noInventoryGui:!0},[4,appViewer.resourcesManager.loadSourceData(e.version)];case 2:return b.sent(),[4,appViewer.resourcesManager.updateAssetsData({})];case 3:if(b.sent(),appViewer.backend)return[3,5];return[4,appViewer.loadBackend(J.z["0"])];case 4:b.sent(),b.label=5;case 5:return[4,appViewer.startWorld(r,e.viewDistance,(0,h.sj)((0,Q.Rv)()),e.targetPos)];case 6:if(b.sent(),e.worldView=appViewer.worldView,e.camera=new M.c(appViewer.inWorldRenderingConfig.fov||75,window.innerWidth/window.innerHeight,.1,1e3),e.setupWorld(),!e.worldView)return[3,8];return e.worldView.addWaitTime=0,[4,e.worldView.init(e.targetPos)];case 7:b.sent(),b.label=8;case 8:return e.enableCameraControls&&(o=document.querySelector("#viewer-canvas"))&&(a=e.enableCameraOrbitControl?new G.z(e.camera,o):void 0,e.controls=a,e.resetCamera(),(i=e.params.camera||localStorage.camera)&&(c=(d=(0,l._)(i.split(",").map(Number),5))[0],u=d[1],p=d[2],m=d[3],f=d[4],e.camera.position.set(c,u,p),e.camera.rotation.set(m,f,0,"ZYX"),null==(s=e.controls)||s.update()),w=H().throttle(function(){e.camera&&(localStorage.camera=[e.camera.position.x.toFixed(2),e.camera.position.y.toFixed(2),e.camera.position.z.toFixed(2),e.camera.rotation.x.toFixed(2),e.camera.rotation.y.toFixed(2)].join(","))},200),e.controls?(v=H().throttle(function(){},16),e.controls.addEventListener("change",function(){v(),w(),e.requestRender()})):setInterval(function(){w()},200)),!e.enableCameraOrbitControl&&e.camera&&(y=0,g=function(t){t.target.closest(".lil-gui")||((1===t.buttons||"touch"===t.pointerType)&&(y++,e.camera.rotation.x-=t.movementY/100,e.camera.rotation.y-=t.movementX/100,e.camera.rotation.x<-Math.PI/2&&(e.camera.rotation.x=-Math.PI/2),e.camera.rotation.x>Math.PI/2&&(e.camera.rotation.x=Math.PI/2),e.syncCameraToBackend(!0)),2===t.buttons&&(e.camera.position.set(0,0,0),e.syncCameraToBackend()))},setInterval(function(){y=0},1e3),window.addEventListener("pointermove",g)),e.onResize(),window.addEventListener("resize",function(){return e.onResize()}),e.setupDebugFpsGui(),e.renderFinish(),e.mainDebugLoop(),[2]}})})()},e.mainDebugLoop=function(){var e=this;requestAnimationFrame(function(){return e.mainDebugLoop()}),this.trackFrame()},e.loop=function(){var e=this;this.continuousRender&&!this.windowHidden&&(this.requestRender(),requestAnimationFrame(function(){return e.loop()}))},e.requestRender=function(){},e.setupDebugFpsGui=function(){var e=this;this.debugFpsElement=document.createElement("div"),this.debugFpsElement.style.position="fixed",this.debugFpsElement.style.bottom="0",this.debugFpsElement.style.left="0",this.debugFpsElement.style.zIndex="1000",this.debugFpsElement.style.backgroundColor="rgba(0, 0, 0, 0.7)",this.debugFpsElement.style.color="#fff",this.debugFpsElement.style.padding="4px 6px",this.debugFpsElement.style.fontFamily="monospace",this.debugFpsElement.style.fontSize="11px",this.debugFpsElement.style.lineHeight="1.2",this.debugFpsElement.style.pointerEvents="none",this.debugFpsElement.style.userSelect="none",this.debugFpsElement.textContent="FPS: 0 | Max: 0 ms",document.body.appendChild(this.debugFpsElement),setInterval(function(){e.updateDebugInfo()},1e3)},e.trackFrame=function(){var e=performance.now();if(this.frameTimes.push(e),this.frameCount++,this.frameTimes.length>1){var t=e-this.frameTimes.at(-2);t>this.maxFrameDelay&&(this.maxFrameDelay=t)}var n=e-1e3;this.frameTimes=this.frameTimes.filter(function(e){return e>n})},e.updateDebugInfo=function(){if(this.debugFpsElement){var e=this.frameTimes.length;this.currentFps=e;var t=this.maxFrameDelay>150?'<span style="color: #ff4444;">'.concat(this.maxFrameDelay.toFixed(0),"ms</span>"):"".concat(this.maxFrameDelay.toFixed(0),"ms");this.debugFpsElement.innerHTML="FPS: ".concat(e," | Max Delay: ").concat(t),this.lastSecondTime=performance.now(),this.maxFrameDelay=0,this.frameCount=0}},e.render=function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0],this.requestRender()},e.addKeyboardShortcuts=function(){var e=this;document.addEventListener("keydown",function(t){if(!t.shiftKey&&!t.ctrlKey&&!t.altKey&&!t.metaKey){if("KeyR"===t.code){var n;null==(n=e.controls)||n.reset(),e.resetCamera()}"KeyE"===t.code&&e.worldView.setBlockStateId(e.targetPos,e.world.getBlockStateId(e.targetPos)),"KeyF"===t.code&&(e.sceneReset(),e.worldView.unloadAllChunks(),e.worldView.init(e.targetPos))}}),document.addEventListener("visibilitychange",function(){e.windowHidden="hidden"===document.visibilityState}),document.addEventListener("blur",function(){e.windowHidden=!0}),document.addEventListener("focus",function(){e.windowHidden=!1});var t=new Set;setInterval(function(){if(!(t.has("ControlLeft")||t.has("MetaLeft"))&&e.camera){var n,r=new L.P(0,0,0);t.has("KeyW")&&(r.z=-.5),t.has("KeyS")&&(r.z+=.5),t.has("KeyA")&&(r.x-=.5),t.has("KeyD")&&(r.x+=.5),t.has("ShiftLeft")&&(e.camera.position.y-=.5),t.has("Space")&&(e.camera.position.y+=.5),r.applyQuaternion(e.camera.quaternion),r.y=0,t.has("ShiftLeft")&&(r.y*=2,r.x*=2,r.z*=2),e.camera.position.add(r.normalize()),null==(n=e.controls)||n.update(),e.syncCameraToBackend(),e.requestRender()}},50);var keys=function(e){var n=e.code;"keydown"===e.type?t.add(n):t.delete(n)};window.addEventListener("keydown",keys),window.addEventListener("keyup",keys),window.addEventListener("blur",function(){var e=!0,n=!1,r=void 0;try{for(var o,a=t[Symbol.iterator]();!(e=(o=a.next()).done);e=!0){var i=o.value;keys(new KeyboardEvent("keyup",{code:i}))}}catch(e){n=!0,r=e}finally{try{e||null==a.return||a.return()}finally{if(n)throw r}}})},e.onResize=function(){this.requestRender()},(0,D._)(BasePlaygroundScene,[{key:"worldRenderer",get:function(){return window.world}},{key:"worldConfig",get:function(){return appViewer.inWorldRenderingConfig},set:function(e){Object.assign(appViewer.inWorldRenderingConfig,e)}}]),BasePlaygroundScene}(),$=n(32627),ee=n(94018),et=null!=(o=globalThis.includedVersions)?o:N.ZP;let en=function(e){function MainScene(){for(var e,t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return(0,_._)(this,MainScene),(e=(0,S._)(this,MainScene,(0,R._)(n))).blockProps={},e.onParamUpdate={version:function(){},block:function(){e.blockProps={},null==(s=e.metadataFolder)||s.destroy();var t=mcData.blocksByName[e.params.block];if(t){console.log("block",t.name);var n=new e.Block(t.id,0,0).getProperties(),r=(null!=(c=mcData.blocksByStateId[null==(d=e.getBlock())?void 0:d.minStateId])?c:{}).states;if(e.metadataFolder=e.gui.addFolder("metadata"),r){var o=!0,a=!1,i=void 0;try{for(var s,d,c,u,p=r[Symbol.iterator]();!(o=(u=p.next()).done);o=!0){var h=u.value,m=void 0;if(h.values)m=h.values[0];else switch(h.type){case"bool":m=!1;break;case"int":m=0;break;case"direction":m="north";break;default:continue}e.blockProps[h.name]=m,h.values?e.metadataFolder.add(e.blockProps,h.name,h.values):e.metadataFolder.add(e.blockProps,h.name)}}catch(e){a=!0,i=e}finally{try{o||null==p.return||p.return()}finally{if(a)throw i}}}else{var f=!0,w=!1,v=void 0;try{for(var y,g=Object.entries(n)[Symbol.iterator]();!(f=(y=g.next()).done);f=!0){var b=(0,l._)(y.value,2),k=b[0],S=b[1];e.blockProps[k]=S,e.metadataFolder.add(e.blockProps,k)}}catch(e){w=!0,v=e}finally{try{f||null==g.return||g.return()}finally{if(w)throw v}}}console.log("props",e.blockProps),e.metadataFolder.open()}},entity:function(){e.continuousRender="player"===e.params.entity,e.entityUpdateShared(),e.params.entity&&("player"===e.params.entity&&(e.worldRenderer.entities.updatePlayerSkin("id",e.worldRenderer.entities.entities.id.username,void 0,!0,!0),e.worldRenderer.entities.playAnimation("id","running")),ee.SE.getStaticData(e.params.entity))},supportBlock:function(){e.worldView.setBlockStateId(e.targetPos.offset(0,-1,0),+!!e.params.supportBlock)},modelVariant:function(){e.worldRenderer.worldRendererConfig.debugModelVariant=0===e.params.modelVariant?void 0:[e.params.modelVariant]}},e}(0,B._)(MainScene,e);var t=MainScene.prototype;return t.initGui=function(){this.params={version:et.at(-1),skipQs:"",block:"",metadata:0,supportBlock:!1,entity:"",removeEntity:function(){this.entity=""},entityRotate:!1,camera:"",playSound:function(){},blockIsomorphicRenderBundle:function(){},modelVariant:0},this.metadataGui=this.gui.add(this.params,"metadata"),this.paramOptions={version:{options:et,hide:!1},block:{options:mcData.blocksArray.map(function(e){return e.name}).sort(function(e,t){return e.localeCompare(t)})},entity:{options:mcData.entitiesArray.map(function(e){return e.name}).sort(function(e,t){return e.localeCompare(t)})},camera:{hide:!0}},(0,x._)((0,C._)(MainScene.prototype),"initGui",this).call(this)},t.entityUpdateShared=function(){var e=this;if(this.worldRenderer.entities.clear(),this.params.entity){this.worldView.emit("entity",{id:"id",name:this.params.entity,pos:this.targetPos.offset(.5,1,.5),width:1,height:1,username:localStorage.testUsername,yaw:Math.PI,pitch:0});var enableSkeletonDebug=function(e){var t=e.children,n=e.isSkeletonHelper;if(Array.isArray(t)){if(n){e.visible=!0;return}var r=!0,o=!1,a=void 0;try{for(var i,s=t[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var l=i.value;(void 0===l?"undefined":(0,P._)(l))==="object"&&enableSkeletonDebug(l)}}catch(e){o=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw a}}}};enableSkeletonDebug(this.worldRenderer.entities.entities.id),setTimeout(function(){e.render()},$.H0)}},t.getBlock=function(){return mcData.blocksByName[this.params.block||"air"]},t.onParamsUpdate=function(e,t){var n=null==(s=this.getBlock())?void 0:s.id;if("metadata"===e){l=new this.Block(n,0,this.params.metadata),Object.assign(this.blockProps,l.getProperties());var r=!0,o=!1,a=void 0;try{for(var i,s,l,d,c=this.metadataFolder.children[Symbol.iterator]();!(r=(d=c.next()).done);r=!0)d.value.updateDisplay()}catch(e){o=!0,a=e}finally{try{r||null==c.return||c.return()}finally{if(o)throw a}}}else try{l=this.Block.fromProperties(null!=n?n:-1,this.blockProps,0)}catch(e){console.error(e),l=this.Block.fromStateId(0,0)}this.worldView.setBlockStateId(this.targetPos,null!=(i=l.stateId)?i:0),console.log("up stateId",l.stateId),this.params.metadata=l.metadata,this.metadataGui.updateDisplay()},t.renderFinish=function(){var e=!0,t=!1,n=void 0;try{for(var r,o=Object.values(this.onParamUpdate)[Symbol.iterator]();!(e=(r=o.next()).done);e=!0)(0,r.value)()}catch(e){t=!0,n=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw n}}this.onParamsUpdate("",{}),this.gui.openAnimated()},t.blockIsomorphicRenderBundle=function(){var e=this,t=this.worldRenderer.renderer,n=t.domElement,r=!confirm("Ok - render all blocks, Cancel - render only current one"),o=prompt("Size","512");if(o){var a,i,s=parseInt(o,10);n.width=s,n.height=s,t.setSize(s,s),this.worldRenderer.camera=new U.i(-1,1,1,-1,0,10),this.worldRenderer.scene.background=null;var l=I.M8.degToRad(-120);this.worldRenderer.directionalLight.position.set(Math.cos(l),Math.sin(l),.2).normalize(),this.worldRenderer.directionalLight.intensity=1;var d=this.targetPos.offset(2,2,2),c=I.M8.degToRad(-30),u=I.M8.degToRad(45);this.worldRenderer.camera.rotation.set(c,u,0,"ZYX"),this.worldRenderer.camera.position.set(d.x+1,d.y+.5,d.z+1);var p=mcData.blocksArray.map(function(e){return e.name}),h=1,m=p[0],updateBlock=function(){e.params.block=m},f=this;this.worldRenderer.waitForChunksToRender().then((0,k._)(function(){return(0,F.Jh)(this,function(e){switch(e.label){case 0:return[4,new Promise(function(e){setTimeout(e,0)})];case 1:return e.sent(),r?(f.render(),onWorldUpdate()):(f.worldRenderer.renderUpdateEmitter.addListener("update",onWorldUpdate),updateBlock()),[2]}})}));var w=new(W());w.file("description.txt","Generated with mcraft.fun/playground");var v=this,y=(a=(0,k._)(function(){var e,t,n;return(0,F.Jh)(this,function(r){switch(r.label){case 0:return e=document.createElement("a"),[4,w.generateAsync({type:"blob"})];case 1:return t=r.sent(),n=URL.createObjectURL(t),e.href=n,e.download="blocks_render.zip",e.click(),URL.revokeObjectURL(n),console.log("end"),v.worldRenderer.renderUpdateEmitter.removeListener("update",onWorldUpdate),[2]}})}),function(){return a.apply(this,arguments)}),g=(i=(0,k._)(function(){return(0,F.Jh)(this,function(e){switch(e.label){case 0:if(m=p[h++],console.log(p.length,"/",h,m),h%5!=0)return[3,2];return[4,new Promise(function(e){setTimeout(e,100)})];case 1:e.sent(),e.label=2;case 2:return m?updateBlock():y(),[2]}})}),function(){return i.apply(this,arguments)})}function onWorldUpdate(){return _onWorldUpdate.apply(this,arguments)}function _onWorldUpdate(){return(_onWorldUpdate=(0,k._)(function(){var e;return(0,F.Jh)(this,function(t){return e=n.toDataURL("image/png"),w.file("".concat(m,".png"),e.split(",")[1],{base64:!0}),r?y():g(),[2]})})).apply(this,arguments)}},MainScene}(X);var er=function(e){function RailsCobwebScene(){return(0,_._)(this,RailsCobwebScene),(0,S._)(this,RailsCobwebScene,arguments)}return(0,B._)(RailsCobwebScene,e),RailsCobwebScene.prototype.setupWorld=function(){this.addWorldBlock(0,0,0,"cobweb"),this.addWorldBlock(0,-1,0,"cobweb"),this.addWorldBlock(1,-1,0,"cobweb"),this.addWorldBlock(1,0,0,"cobweb"),this.addWorldBlock(0,0,1,"powered_rail",{shape:"north_south",waterlogged:!1}),this.addWorldBlock(0,0,2,"powered_rail",{shape:"ascending_south",waterlogged:!1}),this.addWorldBlock(0,1,3,"powered_rail",{shape:"north_south",waterlogged:!1})},RailsCobwebScene}(X),eo=function(e){function RailsCobwebScene(){var e;return(0,_._)(this,RailsCobwebScene),e=(0,S._)(this,RailsCobwebScene,arguments),e.viewDistance=5,e.continuousRender=!0,e}(0,B._)(RailsCobwebScene,e);var t=RailsCobwebScene.prototype;return t.initGui=function(){this.params={squareSize:50},(0,x._)((0,C._)(RailsCobwebScene.prototype),"initGui",this).call(this)},t.setupWorld=function(){var e,t=this,n=null!=(e=this.params.squareSize)?e:30,r=16*this.viewDistance*2;if(n>r)throw Error("Square size too big, max is ".concat(r));for(var o=loadedData.blocksArray.filter(function(e){var n,r=t.Block.fromStateId(e.defaultState,0);if((null==(n=r.shapes)?void 0:n.length)!==1)return!1;var o=r.shapes[0];return 0===o[0]&&0===o[1]&&0===o[2]&&1===o[3]&&1===o[4]&&1===o[5]}),a=-n;a<=n;a++)for(var i=-n;i<=n;i++){var s=Math.abs(a+i)*n;worldView.world.setBlock(this.targetPos.offset(a,0,i),this.Block.fromStateId(o[s%o.length].defaultState,0))}},RailsCobwebScene}(X),ea=n(8674),ei=function(e){function _class(){var e;return(0,_._)(this,_class),e=(0,S._)(this,_class,arguments),e.continuousRender=!0,e}(0,B._)(_class,e);var t=_class.prototype;return t.setupWorld=function(){var e,t,n,r;viewer.world.mesherConfig.enableLighting=!0,viewer.world.mesherConfig.skyLight=0,this.addWorldBlock(0,0,0,"stone"),this.addWorldBlock(0,0,1,"stone"),this.addWorldBlock(1,0,0,"stone"),this.addWorldBlock(1,0,1,"stone"),null==(e=worldView)||e.world.setBlockLight(this.targetPos.offset(0,1,0),15),null==(t=worldView)||t.world.setBlockLight(this.targetPos.offset(0,1,1),0),null==(n=worldView)||n.world.setBlockLight(this.targetPos.offset(1,1,0),0),null==(r=worldView)||r.world.setBlockLight(this.targetPos.offset(1,1,1),15)},t.renderFinish=function(){viewer.scene.background=new ea.I(0),viewer.world.starField.enabled=!0,viewer.world.starField.addToScene(),viewer.entities.update({id:0,name:"player",pos:this.targetPos.clone()},{}),viewer.entities.update({id:1,name:"creeper",pos:this.targetPos.offset(1,0,0)},{})},_class}(X),es=function(e){function _class(){return(0,_._)(this,_class),(0,S._)(this,_class,arguments)}return(0,B._)(_class,e),_class.prototype.setupWorld=function(){this.addWorldBlock(0,0,0,"water"),this.addWorldBlock(0,1,0,"lime_stained_glass"),this.addWorldBlock(0,0,-1,"lime_stained_glass"),this.addWorldBlock(0,-1,0,"lime_stained_glass"),this.addWorldBlock(0,-1,-1,"stone")},_class}(X),el=function(e){function RotationIssueScene(){return(0,_._)(this,RotationIssueScene),(0,S._)(this,RotationIssueScene,arguments)}return(0,B._)(RotationIssueScene,e),RotationIssueScene.prototype.setupWorld=function(){},RotationIssueScene}(X),ed=function(e){function _class(){var e;return(0,_._)(this,_class),e=(0,S._)(this,_class,arguments),e.continuousRender=!0,e}(0,B._)(_class,e);var t=_class.prototype;return t.initGui=function(){this.params={starfield:!1,entity:"player",count:4}},t.renderFinish=function(){this.params.starfield&&(viewer.world.scene.background=new ea.I(0),viewer.world.starField.enabled=!0,viewer.world.starField.addToScene());for(var e=0;e<this.params.count;e++)for(var t=0;t<this.params.count;t++)for(var n=0;n<this.params.count;n++)viewer.entities.update({id:1e3*e+100*t+n,name:this.params.entity,pos:this.targetPos.offset(e,t,n)},{})},_class}(X),ec=function(e){function _class(){var e;return(0,_._)(this,_class),e=(0,S._)(this,_class,arguments),e.viewDistance=5,e.continuousRender=!0,e.lastUpdatedOffset=0,e.lastUpdatedId=2,e}(0,B._)(_class,e);var t=_class.prototype;return t.initGui=function(){var e=this;this.params={testActive:!1,testUpdatesPerSecond:10,testInitialUpdate:!1,stopGeometryUpdate:!1,manualTest:function(){e.updateBlock()},testNeighborUpdates:function(){e.testNeighborUpdates()}},(0,x._)((0,C._)(_class.prototype),"initGui",this).call(this)},t.updateBlock=function(){var e=this.lastUpdatedOffset%16,t=Math.floor(this.lastUpdatedOffset/16);worldView.setBlockStateId(new v.A(e,90,t),this.lastUpdatedId++),this.lastUpdatedOffset++,this.lastUpdatedOffset>256&&(this.lastUpdatedOffset=0),this.lastUpdatedId>500&&(this.lastUpdatedId=1)},t.testNeighborUpdates=function(){viewer.world.setBlockStateId(new v.A(15,95,15),1),viewer.world.setBlockStateId(new v.A(0,95,15),1),viewer.world.setBlockStateId(new v.A(15,95,0),1),viewer.world.setBlockStateId(new v.A(0,95,0),1),viewer.world.setBlockStateId(new v.A(16,95,15),1),viewer.world.setBlockStateId(new v.A(-1,95,15),1),viewer.world.setBlockStateId(new v.A(15,95,-1),1),viewer.world.setBlockStateId(new v.A(-1,95,0),1),setTimeout(function(){viewer.world.setBlockStateId(new v.A(16,96,16),1),viewer.world.setBlockStateId(new v.A(-1,96,16),1),viewer.world.setBlockStateId(new v.A(16,96,-1),1),viewer.world.setBlockStateId(new v.A(-1,96,-1),1)},3e3)},t.setupTimer=function(){var e=this,t=0,tick=function(){viewer.world.debugStopGeometryUpdate=e.params.stopGeometryUpdate;var n=1e3/e.params.testUpdatesPerSecond;if(requestAnimationFrame(tick),e.params.testActive){for(var r=Math.floor(performance.now()-t)/n,o=0;o<r;o++)e.updateBlock();t=performance.now()}};requestAnimationFrame(tick)},t.setupWorld=function(){var e=this;this.worldConfig.showChunkBorders=!0;for(var t=16*this.viewDistance,n=-t;n<=t;n++)for(var r=-t;r<=t;r++)worldView.world.setBlock(this.targetPos.offset(n,0,r),this.Block.fromStateId(1,0));var o=!1;viewer.world.renderUpdateEmitter.on("update",function(){viewer.world.allChunksFinished&&!o&&(o=!0,e.setupTimer())}),setTimeout(function(){e.params.testInitialUpdate&&e.updateBlock()})},_class}(X),eu=function(e){function _class(){var e;return(0,_._)(this,_class),e=(0,S._)(this,_class,arguments),e.expectedNumberOfFaces=30,e.enableCameraOrbitControl=!1,e}return(0,B._)(_class,e),_class.prototype.setupWorld=function(){this.addWorldBlock(0,1,0,"stone_slab"),this.addWorldBlock(0,0,0,"stone"),this.addWorldBlock(0,-1,0,"stone_slab",{type:"top",waterlogged:!1}),this.addWorldBlock(0,-1,-1,"stone_slab",{type:"top",waterlogged:!1}),this.addWorldBlock(0,-1,1,"stone_slab",{type:"top",waterlogged:!1}),this.addWorldBlock(-1,-1,0,"stone_slab",{type:"top",waterlogged:!1}),this.addWorldBlock(1,-1,0,"stone_slab",{type:"top",waterlogged:!1})},_class}(X),ep=n(76442),eh=function(e){function AllEntities(){var e;return(0,_._)(this,AllEntities),e=(0,S._)(this,AllEntities,arguments),e.continuousRender=!1,e.enableCameraControls=!1,e}return(0,B._)(AllEntities,e),AllEntities.prototype.initData=function(){var e=this,t=this;return(0,k._)(function(){return(0,F.Jh)(this,function(n){switch(n.label){case 0:return[4,(0,x._)((0,C._)(AllEntities.prototype),"initData",e).call(t)];case 1:return n.sent(),(0,ep.I)(t.version),[2]}})})()},AllEntities}(X);n(64912),n(81812);var em=n(76804),ef=n(16717),ew=function(e){function _class(){(0,_._)(this,_class);var e,t,n=null!=(t=new URLSearchParams(window.location.search).get("geometryUrl"))?t:"world-geometry.json";return(e=(0,S._)(this,_class,[{viewDistance:+!n,continuousRender:!1,enableCameraOrbitControl:!1}])).params={exportGeometry:function(){return e.exportGeometry()},exportWithTexture:function(){return e.exportGeometry(!0)}},e.loadedGeometry=null,e.importedMeshes=[],e.geometryUrl=n,e}(0,B._)(_class,e);var t=_class.prototype;return t.initData=function(){var e=this,t=this;return(0,k._)(function(){return(0,F.Jh)(this,function(n){switch(n.label){case 0:return[4,(0,x._)((0,C._)(_class.prototype),"initData",e).call(t)];case 1:if(n.sent(),!t.geometryUrl)return[3,3];return[4,t.loadFromUrl(t.geometryUrl)];case 2:n.sent(),n.label=3;case 3:return[2]}})})()},t.setupWorld=function(){this.geometryUrl||(this.addWorldBlock(0,0,0,"stone"),this.addWorldBlock(1,0,0,"grass_block"),this.addWorldBlock(0,0,1,"dirt"),this.addWorldBlock(1,0,1,"cobblestone"),this.addWorldBlock(0,1,0,"oak_log"),this.addWorldBlock(1,1,0,"oak_planks"))},t.loadFromUrl=function(e){var t=this;return(0,k._)(function(){var n,r,o,a,i,s,l,d,c,u,p,h,m,f,w;return(0,F.Jh)(this,function(v){switch(v.label){case 0:return v.trys.push([0,5,,6]),console.log("Loading geometry from:",e),[4,(0,ef.m2)(e)];case 1:if(t.loadedGeometry=v.sent(),r=t.loadedGeometry.camera,t.camera.position.set(r.position.x,r.position.y,r.position.z),a=(o=r.rotation).pitch,i=o.yaw,s=new L.P(-Math.sin(i)*Math.cos(a),Math.sin(a),-Math.cos(i)*Math.cos(a)),t.camera.lookAt(r.position.x+s.x,r.position.y+s.y,r.position.z+s.z),null==(n=t.controls)||n.update(),t.syncCameraToBackend(),!t.loadedGeometry.textureAtlasDataUrl)return[3,3];return[4,(0,ef.iq)(t.loadedGeometry.textureAtlasDataUrl)];case 2:return d=v.sent(),l=new em.Y({map:d,vertexColors:!0,transparent:!0,alphaTest:.1}),[3,4];case 3:l=t.worldRenderer.material,v.label=4;case 4:t.importedMeshes=(0,ef.Pw)(t.loadedGeometry,l),c=t.worldRenderer.scene,u=!0,p=!1,h=void 0;try{for(m=t.importedMeshes[Symbol.iterator]();!(u=(f=m.next()).done);u=!0)w=f.value,c.add(w)}catch(e){p=!0,h=e}finally{try{u||null==m.return||m.return()}finally{if(p)throw h}}return console.log("Loaded ".concat(t.importedMeshes.length," sections from geometry file")),t.requestRender(),[3,6];case 5:return console.error("Failed to load geometry:",v.sent()),[3,6];case 6:return[2]}})})()},t.exportGeometry=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.worldRenderer;if(!t)return void console.error("WorldRenderer not available");var n={x:this.camera.position.x,y:this.camera.position.y,z:this.camera.position.z},r=new L.P(0,0,-1);r.applyQuaternion(this.camera.quaternion);var o={yaw:Math.atan2(-r.x,-r.z),pitch:Math.asin(r.y)},a=new Date().toISOString().replaceAll(/[:.]/g,"-"),i="world-geometry-".concat(a,".json");(0,ef.p9)(t,n,o,i,e),console.log("Geometry exported to:",i)},_class}(X),ev=new URLSearchParams(window.location.search).get("scene"),ey=ev?a[ev]:en;b.scenes=["main","railsCobweb","floorRandom","lightingStarfield","transparencyIssue","entities","frequentUpdates","slabsOptimization","allEntities","geometryExport"],b.selected=null!=ev?ev:"main";var eg=new ey;globalThis.scene=eg}}]);
//# sourceMappingURL=707.92cced21.js.map